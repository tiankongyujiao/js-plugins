<!DOCTYPE>
<html>
  <head>
    <title>
      html2canvas example
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./layui/css/layui.css">
  </head>
  <body>
    <div class="tools">
        <button id="btn-html2canvas">export PDF by using jspdf + html2canvas</button>
    </div>

    <div class="container">

        <div id="content" style="position: relative;">
        	<div>
	            <div class="content-banner">
	                <img class="content-banner-logo" src="./image/logo.jpg" alt="logo">
	                <h2>How Transform HTML Into PDF</h2>
	            </div>
	            <div class="content-main" id="main">
	                <!-- <div id="zj" style="position: absolute; top: 286px; left: 0; width: 600px;height: 300px;transform: scale(1.5); background-position: 50% 50%;">
	                  <h3 style="position: absolute; right: 0;  top: 200px; width: 200px; background-color: #f40; border-radius: 50%;">Hello World!2</h3>
	                  <div style="width: 600px; height: 200px; position: absolute; top: 0; left: 0; background-image: url(./image/banner.jpg); background-size: 100%;"></div>
	                </div> -->
	                <div>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <h3>Hello World!</h3>
	                  <table class="layui-hide" id="demo"></table>
					  
	                </div>
	            </div>
	        </div>
        </div>

    </div>
    <script type="text/javascript" src="https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/lib/jquery-1-edb203c114.10.2.js"></script>
    <script type="text/javascript" src="./js/html2canvas.js"></script>
    <script type="text/javascript" src="./layui/layui.js"></script>
    <script type="text/javascript" src="./js/jsPdf.debug.js"></script>
    <script type="text/javascript">
      layui.use('table', function(){
		  var table = layui.table;
		  
		  //展示已知数据
		  table.render({
		    elem: '#demo',
                width: 892,
                height: 330
		    ,cols: [[ //标题栏
		      {field: 'id', title: 'ID', width: 80, sort: true, fixed: 'left'}
		      ,{field: 'username', title: '用户名', width: 120}
		      ,{field: 'email', title: '邮箱', width: 150}
		      ,{field: 'sign', title: '签名', width: 160}
		      ,{field: 'sex', title: '性别', width: 180}
		      ,{field: 'city', title: '城市', width: 200}
		      ,{field: 'experience', title: '积分', width: 200, sort: true}
		    ]]
		    ,data: [{
		      "id": "10001"
		      ,"username": "杜甫"
		      ,"email": "xianxin@layui.com"
		      ,"sex": "男"
		      ,"city": "浙江杭州"
		      ,"sign": "人生恰似一场修行"
		      ,"experience": "116"
		      ,"ip": "192.168.0.8"
		      ,"logins": "108"
		      ,"joinTime": "2016-10-14"
		    }, {
		      "id": "10002"
		      ,"username": "李白"
		      ,"email": "xianxin@layui.com"
		      ,"sex": "男"
		      ,"city": "浙江杭州"
		      ,"sign": "人生恰似一场修行"
		      ,"experience": "12"
		      ,"ip": "192.168.0.8"
		      ,"logins": "106"
		      ,"joinTime": "2016-10-14"
		      ,"LAY_CHECKED": true
		    }, {
		      "id": "10003"
		      ,"username": "王勃"
		      ,"email": "xianxin@layui.com"
		      ,"sex": "男"
		      ,"city": "浙江杭州"
		      ,"sign": "人生恰似一场修行"
		      ,"experience": "65"
		      ,"ip": "192.168.0.8"
		      ,"logins": "106"
		      ,"joinTime": "2016-10-14"
		    }, {
		      "id": "10004"
		      ,"username": "贤心"
		      ,"email": "xianxin@layui.com"
		      ,"sex": "男"
		      ,"city": "浙江杭州"
		      ,"sign": "人生恰似一场修行"
		      ,"experience": "666"
		      ,"ip": "192.168.0.8"
		      ,"logins": "106"
		      ,"joinTime": "2016-10-14"
		    }, {
		      "id": "10005"
		      ,"username": "贤心"
		      ,"email": "xianxin@layui.com"
		      ,"sex": "男"
		      ,"city": "浙江杭州"
		      ,"sign": "人生恰似一场修行"
		      ,"experience": "86"
		      ,"ip": "192.168.0.8"
		      ,"logins": "106"
		      ,"joinTime": "2016-10-14"
		    }, {
		      "id": "10006"
		      ,"username": "贤心"
		      ,"email": "xianxin@layui.com"
		      ,"sex": "男"
		      ,"city": "浙江杭州"
		      ,"sign": "人生恰似一场修行"
		      ,"experience": "12"
		      ,"ip": "192.168.0.8"
		      ,"logins": "106"
		      ,"joinTime": "2016-10-14"
		    }, {
		      "id": "10007"
		      ,"username": "贤心2"
		      ,"email": "xianxin@layui.com"
		      ,"sex": "男"
		      ,"city": "浙江杭州"
		      ,"sign": "人生恰似一场修行"
		      ,"experience": "16"
		      ,"ip": "192.168.0.8"
		      ,"logins": "106"
		      ,"joinTime": "2016-10-14"
		    }, {
		      "id": "10008"
		      ,"username": "贤心"
		      ,"email": "xianxin@layui.com"
		      ,"sex": "男"
		      ,"city": "浙江杭州"
		      ,"sign": "人生恰似一场修行"
		      ,"experience": "106"
		      ,"ip": "192.168.0.8"
		      ,"logins": "106"
		      ,"joinTime": "2016-10-14"
		    }]
		    //,skin: 'line' //表格风格
		    ,even: true
		    //,page: true //是否显示分页
		    //,limits: [5, 7, 10]
		    //,limit: 5 //每页默认显示的数量
		  });
		});

      var downPdf = document.getElementById("btn-html2canvas");

      downPdf.onclick = function() {
          html2canvas(document.getElementById('content'), {
            background: '#fff',
            width: document.getElementById('content').getBoundingClientRect().width,
            height: document.getElementById('content').getBoundingClientRect().height
          }).then(canvas=> {
            var contentWidth = canvas.width;
            var contentHeight = canvas.height;

            //一页pdf显示html页面生成的canvas高度;
            var pageHeight = contentWidth / 592.28 * 841.89;
            //未生成pdf的html页面高度
            var leftHeight = contentHeight;
            //pdf页面偏移
            var position = 0;
            //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
            var imgWidth = 595.28;
            var imgHeight = 592.28/contentWidth * contentHeight;

            var pageData = canvas.toDataURL('image/jpeg', 1.0);

            var pdf = new jsPDF('', 'pt', 'a4');

            //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)
            //当内容未超过pdf一页显示的范围，无需分页
            if (leftHeight < pageHeight) {
                pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight );
            } else {
              console.log(258369)
                while(leftHeight > 0) {
                    pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
                    leftHeight -= pageHeight;
                    position -= 841.89;
                    //避免添加空白页
                    if(leftHeight > 0) {
                        pdf.addPage();
                    }
                }
            }

            pdf.save('content.pdf');
          })
      }

      
    </script>
  </body>
</html>